\chapter{Composizione di operatori di ordinamento}
\'E molto interessante studiare la combinazione dei vari operatori e le relazioni tra determinati pattern e le loro preimmagini.\\
\paragraph*{Preimmagini} Sia $X$ un operatore di ordinamento, la preimmagine di un certo pattern $p$, secondo $X$, indicata con $X^{-1}(p)$ rappresenta l'insieme di tutte le permutazioni la cui immagine secondo l'operatore $X$ contiene il pattern $p$.$$X^{-1}(p) = \{\beta : p\preceq X(\beta)\}$$\\
Dato che $Av(21)$ \'e l'insieme formato dalle sole permutazioni identit\'a, dato che contiene tutte le permutazioni in cui nessun elemento sia disordinato rispetto ad un altro, ovvero solo le permutazioni incrementali, si indica con $X^{-1}(Av(21))$ l'insieme di tutte le permutazioni ordinabili da $X$.\\\\
Ad esempio, dato che \'e noto che l'operatore \textit{bubblesort} ordina solo le permutazioni che non contengono pattern 231 e 321, vale che:$$B^{-1}(Av(21)) = Av(231,321)$$
\paragraph*{Composizione di operatori} Siano due operatori di ordinamento $X$ e $Y$, la loro composizione \'e indicata con $( XY ) = ( X \circ Y )$, qundi, ad esempio, la composizione di \textit{Stacksort} e \textit{Bubblesort} (in questo ordine) si indica con $SB(\pi) = (S \circ B)(\pi) = S(B(\pi))$.
\paragraph*{Algoritmi per il calcolo di preimmagini} Sono gi\'a stati prodotti alcuni algoritmi per calcolare le preimmagini di pattern secondo gli operaratori \textit{bubblesort}\cite{albert2010inverse}, \textit{stacksort}\cite{claesson2012sorting} e \textit{queuesort}\cite{magnusson2013sorting}\cite{cioni2021characterization}.\\
Questo ci permette, quando si combinano due operatori di ordinamento, di cercare per quali pattern l'operatore che viene applicato per primo produce permutazioni che siano ordinabili dal secondo.
\paragraph*{Combinazione di \textit{Stacksort} e \textit{Bubblesort}} Si considera dunque la composione $SB = S\circ{B}$ e ci si chiede quali permutazioni possano essere ordinate da esso.$$(SB)^{-1}=B^{-1}S^{-1}(Av(21))=B^{-1}(Av(231))$$
Dunque ricercando per quali permutazioni \textit{bubblesort} evita il pattern 231 si trovano le condizioni per cui una permutazione risulta ordinabile da \textit{SB}.\\
Utilizzando i suddetti algoritmi\cite{albert2010inverse} si ottiene che:$$(SB)^{-1}(Av(21))=Av(3241, 2341, 4231, 2431)$$
Si pu\'o notare che bubble sort, applicato a tutte le combinazioni trovate, produce sempre un pattern 231:
\begin{description}
\item[2341:] viene scambiato il 4 con l'1, ottenndo 2314
\item[2431:] viene scambiato il 4 con il 3, poi con l'1, ottenndo 2314
\item[3241:] vengono scambiati il 2 con il 3 e il 4 con l'1, ottenendo 2341
\item[4231:] viene scambiato il 4 con tutti gli elementi fino ad essere alla fine della sequenza.
\end{description}
Si nota da questo esempio un'approccio (senz'altro meno rigoroso degli algoritmi gi\'a formalizzati) che permette in generale di cercare preimmagini secondo bubblesort: dal pattern che si vuole ottenere si cercano le coppie di valori non ordinate (che quindi dovranno essere disordinate anche prima della passata) e si cercano le sequenze che le contengono, queste sequenze verranno dette \textbf{candidati} e ogni preimmagine del pattern deve contenere almeno uno di questi.\\Nel caso specifico del bubblesort, posizionando prima di una coppia disordinata nel pattern originale un valore maggiore, si evita che questa venga ordinata e questo ci permette di trovare le possibili preimmaigini valutando le possibili posizioni e i possibili valori che questo pu\'o assumere.
\paragraph*{Esempio di calcolo di una preimmagine}Volendo ricercare le preimmagini di $231$ secondo \textit{bubblesort} si osserva che le coppie disordinate in $231$ sono $(2,1),(3,1)$, da questo si ricavano una lista di candidati, ovvero di pattern contenuti nelle preimmagini, che dovranno comprendere almeno le stesse coppie disordinate: ovvero $231$ e $321$.
\begin{description}
\item[231:] \textit{bubblesort} lascia invariata la coppia $(2,3)$, ma per produrre un pattern $231$ \'e necessario che non venga scambiata la coppia $(3,1)$, per fare questo si posiziona il valore $4$ prima dell'$1$, in qualunque posizione, ottenendo $4231$, $2431$, $2341$;
\begin{center}
\mmpattern{scale=1.4}{3}{1/2,2/3,3/1}{}{0/3/3/4/1}
\end{center}
\item[321:] per ottenere un $231$ \'e necessario che venga scambiata la coppia $(3,2)$ ma non $(3,1)$, dunque \'e necessario che un valore maggiore di $3$ sia posizionato dopo $2$ ma prima di $1$, cos\'i si ottiene $3241$.
\begin{center}
\mmpattern{scale=1.4}{3}{1/3,2/2,3/1}{}{2/3/3/4/1}
\end{center}
\end{description}
Da queste considerazioni si pu\'o verificare il risultato ottenuto prima per $SB$.\\\\
Lo stesso metodo pu\'o essere applicato alla combinazione di \textit{queuesort} e \textit{bubblesort}:
\section*{$\textit{Q}\circ\textit{B}$:}$$(QB)^{-1}(Av(21))=B^{-1}Q^{-1}(Av(21))=B^{-1}(Av(321))$$Si osserva che le coppie non invertite in $321$ sono $(3,2),(3,1),(2,1)$ e l'unico pattern minimo che le contiene tutte \'e appunto $321$.\\Per fare in modo che \textit{bubblesort} produca un $321$ bisogna dunque che sia presente un valore $4$ prima di $2$: sia che sia posizionato prima di $3$ o tra $3$ e $2$, esso \'e l'unico elemento (tra quelli che compongono il pattern) che viene spostato e il pattern $321$ presente nell'input \'e ancora presente nell'output.\\
\begin{center}
\mmpattern{scale=1.4}{3}{1/3,2/2,3/1}{}{0/3/2/4/1}
\end{center}
Cos\'i si ottengono le preimmagini $4321,3421$.$$QB^{-1}(Av(21))=Av(4321,3421)$$
\section*{Composizioni che terminano con \textit{stacksort}}
L'algoritmo per le preimmagini di \textit{stacksort} \'e abbstanza simile a quello per \textit{bubblesort}.\\
Anche in questo caso si osservano tutte le coppie disordinate contenute nell'immagine in esame e se ne tre una lista di pattern minimi candidati ad essere preimmagini e li si esaminano ad uno ad uno.\\
Per ogni coppia disordinata $(b,a)$ presente nel candidato: 
\begin{description}
\item se $(b,a)$ \'e presente anche nell'immagine allora deve essere presente un elemento $c>b$ tra $b$ e $a$ che fa uscire $b$ dalla pila prima che $a$ vi entri
\begin{center}
\mmpattern{scale=1}{2}{1/2,2/1}{}{} $\Longrightarrow$\mmpattern{scale=1}{2}{1/2,2/1}{}{1/2/2/3/1} 
\end{center}
\item se invece $(b,a)$ non \'e presente allora si pu\'o escludere la presenza di tale elemento
\begin{center}
\mmpattern{scale=1}{2}{1/2,2/1}{}{} $\Longrightarrow$\mmpattern{scale=1}{2}{1/2,2/1}{1/2}{} 
\end{center}
\end{description}
\subsection*{$\textit{Q}\circ\textit{S}$}$$(QS)^{-1}(Av(21))=S^{-1}Q^{-1}(Av(21))=S^{-1}(Av(321))$$
Si ricerca dunque le preimmagini di $321$ secondo \textit{stacksort}.\\$321$ \'e l'unico candidato, quindi sappiamo che tutte le preimmagini devono contenere il pattern $321$.\\
L'elemento $3$ deve entrare nella pila ed uscirne prima del $2$, per fare ci\'o deve esserci un elemento $3^+$ maggiore di $3$ tra $3$ e $2$. Similmente \'e necessario un elemento $2^+>2$ tra $2$ e $1$ per assicurare che $2$ esca dalla pila prima che $1$ vi entri.\\
\begin{center}
\mmpattern{scale=1.5}{3}{1/3,2/2,3/1}{}{1/3/2/4/1,2/2/3/4/1}
\end{center}
Dunque le preimmagini che cerchiamo devono essere nella forma $33^+22^+1$.\\
Se $2^+<3$ allora la preimmagine assume la forma del pattern $45231$.\\
Altrimenti se $2^+>3$, si possono ottenere due diverse preimmagini:
\begin{description}
	\item[$3^+>2^+$] genera il pattern $35241$
	\item[$2^+>3^+$] genera il pattern $34251$
\end{description}
$$(QS)^{-1}(Av(21)) = Av(34251, 35241, 45231)$$
\subsection*{$\textit{B}\circ\textit{S}$}$$(BS)^{-1}(Av(21))=S^{-1}B^{-1}(Av(21))=S^{-1}(Av(231,321))$$
Gi\'a dall'analisi della combinazione precedente \'e risultato che $S^{-1}(Av(321))=Av(34251, 35241, 45231)$ qundi \'e necessario calcolare solo $S^{-1}(Av(231))$. Quest'ultimo risultato \'e stato ampiamente studiato in letteratura, in quanto analogo al caso di una variante di \textit{stacksort} che utilizza 2 pile. Il risultato che si ottiene \'e dunque che $S^{-1}(Av(231))=Av(2341, 3\overline{5}241)$\cite{claesson2012sorting}.\\\\
Seguendo l'algoritmo applicato finora si osserva che i pattern candidati per le preimmagini sono $231,321$.\\\\
Si uniscono dunque i due risultati:
$$S^{-1}(Av(231))=Av(2341,3\overline{5}241), S^{-1}(Av(321))=Av(34251, 35241, 45231)$$
Si osserva che $2341\preceq 34251$, quindi $34251$ non \'e minimo.\\
Inoltre i pattern $35241, 3\overline{5}241$, possono essere rappresentati dal pattern minimo $3241$ che rende non minimo anche $34251$.\\Il risultato che si ottiene \'e:$$(BS)^{-1}(Av(21))=Av(2341,3241,45231)$$
\section*{Combinazioni che terminano con \textit{queuesort}}
Nonostante anche per \textit{queuesort} sia stato trovato un algoritmo per le preimmagini\cite{magnusson2013sorting}, approcciare il problema "manualmente" analizzando i possibili comportamenti di \textit{queuesort} rispetto alle diverse possibili permutazioni risulta essere pi\'u semplice e pi\'u comprensibile.
\paragraph*{left-to-right-maxima}Nel valutare il comportamento di \textit{queuesort} \'e importante considerare la nozione di \textit{left-to-right maxima}, ovvero i valori in una sequenza che risultano maggiori di tutti i valori precedenti ad essi.\\\\
I \textit{left-to-rigth-maxima} di una sequenza sono esattamente tutti gli elementi che vengono inseriti nella coda durante l'applicazione dell'operatore \textit{queuesort}, quindi, se nel valutare il comportamento di \textit{queuesort} rispetto ad una preimmagine se ci si vuole assicurare che un elemento entri nella coda si applicher \'a il seguente mesh-pattern all'elemento in considerazione:
\begin{center}
\mmpattern{scale=1.5}{1}{1/1}{0/1}{}
\end{center}
Al contrario, se si ha a che fare con un elemento che risulta essere un right-to-lrft-maxima ma lo si vuole forzare a svuotare la coda, si avr\'a il seguente risultato:
\begin{center}
\mmpattern{scale=1.5}{1}{1/1}{}{0/1/1/2/1}
\end{center}
Per forzare un elemento a effettuare un bypass \'e necessario che esso sia minore del primo elemento della coda, per questa condizione \'e pi\'u difficile formalizzare una startegia, ma si vedranno in seguito esempi di come pu\'o essere fatto. 
\subsection*{$S\circ{Q}$}$$(SQ)^{-1}(Av(21))=Q^{-1}S^{-1}(Av(21))=Q^{-1}(Av(231))$$Ancora una volta si considerano come candidati i pattern minimi che contengano almeno le coppie disordinate $(2,1),(3,1)$ ovvero $231,321$.\\\\
Se gli elementi del pattern $231$ nell'immagine formano un pattern $321$ nella preimmagine allora il valore $3$ deve entrare nella coda. Sia che $2$ effettui un bypass sia che provochi l'estrazione di alcuni elementi della coda comunque esso viene aggiunto all'output prima che $3$ venga estratto. Si rende necessario un elemento $3^+>3$ posto tra $2$ e $1$ per estarre il $3$ dalla coda e inserirlo nell'input prima dell'$1$, tuttavia $3^+$ non deve essere maggiore dell'elemento in fondo alla coda, altrimenti viene accodato. Si teorizza l'esistenza di un elemento $4>3^+$ posto tra $3$ e $2$, che rappresenta il massimo della coda quando si raggiunge $3^+$.\\
Il pattern che si ottiene deve essere nella forma $3423^+1$, ovvero $35241$\\\\
se invece gli elementi del pattern $231$ nell'immagine formano un pattern $231$ anche nella preimmagine che lo contiene a sua volta \'e necessario che $2$ effettui un bypass o che venga estratto dalla coda prima che $3$ vi entri. Il che implica la presenza di un valore $2^+>2$ prima di $2$ o tra $2$ e $3$.\\Similmente $3$ deve essere aggiunto all'output prima di $1$, qundi deve bypassare o essere estratto prima che $1$ bypassi. Il che implica l'esistenza di un elemento $4$ in posizione precdente a $1$; in particolare i pattern minimi che rispettano queste condizoni sono quelli in cui $4$ compare prima di $2$ e si ha che $2^+=4$.\\
\begin{center}
\mmpattern{scale=1.5}{3}{1/2,2/3,3/1}{}{0/3/2/4/1}
\end{center}
Gli unici pattern minimi che soddisfano queste condizioni sono $2431,4231$.
\\\\Si nota inoltre che, il pattern calcolato prima $35241\in Q^{-1}(Av(321))$ risulta adesso superfluo in quanto $4231\preceq35241$
$$(SQ)^{-1}(Av(21))=Av(2431,4231)$$
\subsection*{$B\circ{Q}$}$$(BQ)^{-1}(Av(21))=Q^{-1}B^{-1}(Av(21))=Q^{-1}(Av(231,321))$$
Ancora una volta, si osserva che $Q^{-1}(Av(231))$ \'e gi\'a stato calcolato nel caso precedente, e resta dunque da unire i risultati gi\'a ottenuti con $Q^{-1}(Av(321))$.\\
Gli elementi del pattern $321$ nell'immagine devono essere a sua volta nello stesso odrine nell'immagine.\\
In particolare gli elementi $3,2$ devono effettuare un bypass o essere inseriti nella coda ed estratti prima dell'elemento successivo.\\\\
\begin{center}
\mmpattern{scale=1.5}{3}{1/3,2/2,3/1}{}{0/3/2/4/1}
\end{center}
Il pattern $4321$ sicuramente soddisfa queste condizioni: se $4$ bypassa allora tutti gli elementi del pattern, essendo minori bypassano a loro volta, se viene inserito in coda ed estratto allora bypassano comunque, se viene inserito in coda e non estratto allora tutti gli elementi successivi evitano la coda e vengono aggiunti all'output, eventualmente dopo aver provocato l'estrazione di alcuni elementi dalla coda.\\
Se $3$ viene aggiunto in coda ed estratto allora si ha una situazione $3421$, dove $2$ bypassa.\\
$$(SQ)^{-1}(Av(21))=Av(2431,3421,4231,4321)$$
\section*{Contenitori POP}
Lo studio di combinazioni di operatori che utilizzano contenitori POP si rivela pi\'u difficile, in quando si tratta di casi non approfonditi in letteratura.\\
Sono tuttavia noti i pattern che rendono una permutazione non ordinabile, come presentato nel capitolo 2, ovvero:
$$S_{POP}^{-1}(Av(21)) = Av(231,312)$$$$Q_{POP}^{-1}(Av(21))=Av(132,321)$$
Grazie a questi dati, \'e possibile individuare un caso di facile risoluzione: ovvero quello in cui un algoritmo che usa contenitori POP \'e concatenato ad un operatore regolare.
$$(X_{POP}\circ{Y})(\pi)= X_{POP}(Y(\pi)))\Rightarrow(X_{POP}\circ{Y})^{-1}(\pi) = Y^{-1}X_{POP}^{-1}(\pi)=Y^{-1}(Av(m))$$
Sapendo l'insieme di pattern $m$ che rendono la permutazione non ordinabile dall'operatore POP baster\'a cercare le loro preimmagini secondo l'operatore regolare con i metodi usati finora, come verr\'a mostrato nelle sezioni seguenti.
\subsection*{POP Queuesort}L'algoritmo POP queuesort richiede una diversa analisi da POP stacksort.\\
Esistono diverse versioni di \textit{POP queuesort} ed in particolare ne esistono due ottimali\cite{cioni2021sorting}: \textit{Min} e \textit{Cons}.
\begin{description}
	\item[\textit{Min}] in questa versione l'operazione di POP viene eseguita solo se il primo elemento della coda \'e il successivo dell'ultimo elemento aggiunto all'output; se l'elemento in input \'e maggiore dell'ultimo elemento della coda (o se la coda \'e vuota) allora viene accodato mentre negli altri casi, se l'elemento dell'input \'e minore della testa della coda allora bypassa altrimenti so esegue un POP.
	\item[\textit{Cons}] questa versione si basa sull'idea di avere sempre elementi consecutivi nella pila; \'e la versione che verr\'a adottata in questa tesi; da qui in avanti ogni riferimento a \textit{POP-queuesort} sar\'a riferito a \textit{Cons}
\end{description}
\begin{algorithm}[H]
   \caption{Cons - POP Queuesort}
\begin{algorithmic}[1]
\State $Q\leftarrow$ empty POP-queue
\For{$i=1$ {\bfseries to} $n-1$}
	\If{empty queue \textbf{or} $\pi_i=Back(Q)+1$}
		\State enqueue($\pi_i$)
	\Else
		\If{ $Front(Q)>\pi_i$}
			\State append $\pi_i$ to the output
		\Else
			\State POP the queue and append the result to the output
			\State enqueue($\pi_i$)
		\EndIf
	\EndIf
\EndFor
\State emtpy the queue in the output
\end{algorithmic}
\end{algorithm}
\subsection*{$S_{POP}\circ{S}$}$$(S_{POP}\circ{S})^{-1}(Av(21))=S^{-1}(Av(231,312))$$
Si \'e gi\'a calcolato che $S^{-1}(Av(231))=Av(2341, 3\overline{5}241)$, quindi manca da calcolare le preimmagini di $312$.\\
I pattern candidati che possono generare $312$ sono quelli che contengono le coppie $(3,1),(3,2)$, ovvero $321, 312$.
Perch\'e gli elementi di un pattern $321$ nella preimmagine generino un pattern $312$ tramite \textit{stacksort} \'e necessario che $3$ entri in pila e ne esca prima che $2$ vi entri, deve quindi essere presente un valore $4$ posizionato tra $3$ e $2$ che provochi l'uscita di $3$, ovvero il pattern $3421$.\\
Se gli elementi del pattern $312$ nell'immagine formano lo stesso pattern anche nella preimmagine allora anche in questo caso bisogna assicurarsi che $3$ venga estratto dalla pila prima di $1$, si ha quindi il pattern $3412$.\\Si uniscono tutti i risultati:
$$(S_{POP}\circ{S})^{-1}(Av(21))=Av(2341, 3\overline{5}241, 3412, 3421)$$
\subsection*{$S_{POP}\circ{B}$}$$(S_{POP}\circ{B})^{-1}(Av(21))=B^{-1}(Av(231,312))$$
Anche in questo caso la preimmagine di $231$ \'e stata calcolata: $B^{-1}(Av(231))= Av(2341, 2431, 3241, 4231)$.\\
Gli elementi del pattern $312$ nell'immagine possono solo formare un pattern $312$ o $321$ nella preimmagine.\\
Si pu\'o osservare come gli stessi elementi di un pattern $321$ non possono divenire un $312$. La presenza dell'elemento maggiore del pattern all'inizio di essa evita l'ordinamento degli elementi successivi.\\
Perch\'e un pattern $312$ rimanga invariato \'e sufficiente la presenza di un elemento maggiore di tutto il pattern in posizione tale da evitare l'ordinamento di $3$ con qualsiasi elemento, applicando le regole descritte prima per \textit{bubblesort}: 
\begin{center}
\mmpattern{scale=1.5}{3}{1/3,2/1,3/2}{}{0/3/2/4/1}$=4312,3412$
\end{center}
$$(S_{POP}\circ{B})^{-1}(Av(21))=Av(2341, 2431, 3241, 3412, 4231, 4312)$$
\subsection*{$S_{POP}\circ{Q}$}$$(S_{POP}\circ{Q})^{-1}(Av(21))=Q^{-1}(Av(231,312))$$$$Q^{-1}(Av(231)=Av(4231,2431)$$
Possibili preimmagini di $312: 312, 321$.\\
Se la preimmagine contiene $312$ bisogna far si che $3$ effettui un bypass o che esca prima di $1$, in ogni caso queste condizioni sono soddisfatte dal seguente mesh-pattern, $4312$:
\begin{center}
\mmpattern{scale=1.5}{3}{1/3,2/1,3/2}{}{1/2/2/3/1}
\end{center}
$$(S_{POP}\circ{Q})^{-1}(Av(21))=Av(2431,4231,4312)$$
\subsection*{$Q_{POP}\circ{S}$}$$(Q_{POP}\circ{S})^{-1}(Av(21))=S^{-1}(Av(132,321))$$$$S^{-1}(Av(321))=Av(34251, 35241, 45231)$$
Si ricercano dunque i pattern che compongono $S^{-1}(Av(132))$. I candidati per le preimmagini sono $132,312,321$.\\
Se la preimagine contiene $132$ allora $1$ entra nella pila, $3$ lo fa uscire (se \'e ancora dentro) ma bisogna assicurarsi che $3$ esca prima di $2$, avendo il pattern $1342$.\\
Se la preimmagine invece contiene $312$ per ottenere $132$ bisogna lasciare che $(3,1)$ vengano ordinati ed aggiunti all'output prima di $2$: si ottiene il pattern $3142$.\\
Se la preimmagine infine contiene $321$ non c'\'e modo di ottenere un $132$ con gli stessi elementi.
$$(Q_{POP}\circ{S})^{-1}(Av(21))=Av(1342, 34251, 35241, 3142, 45231)$$
\subsection*{$Q_{POP}\circ{B}$}$$(Q_{POP}\circ{B})^{-1}(Av(21))=B^{-1}(Av(132,321))$$$$B^{-1}(Av(321))=Av(4321, 3421)$$
Si cerca l'insieme di pattern corrispondente a $B^{-1}(Av(132))$. Le preimmagini devono contenere uno di questi pattern $132,312,321$.\\
Se la preimmagine contiene gli stessi elementi del pattern $132$ nello stesso ordine deve essere presente un elemento maggiore di tutti gli altri prima che venga effettuato il primo scambio, ovvero si deve avere uno dei seguenti pattern: $1432,4132$.\\
Se gli stessi tre elementi formano un pattern $312$ e un pattern $132$ nell'immagine nella preimmagine deve essere possibile scambiare le prime 2 cifre ma non l'ultima, ovvero si deve avere un pattern $3142$, in questo caso, poich\'e la coppia $(1,3)$ si trova prima del $4$ essa verr\'a ordinata comunque, quindi anche il pattern $1342$ \'e ammissibile.\\
Non \'e possibile spostare gli elementi di un pattern $321$ in un pattern $132$.
$$(Q_{POP}\circ{B})^{-1}(Av(21))=Av(1342, 1432, 3142, 3421, 4132, 4321)$$
\subsection*{$Q_{POP}\circ{Q}$}$$(Q_{POP}\circ{Q})^{-1}(Av(21))=Q^{-1}(Av(132,321))$$
Si calcola $Q^{-1}(Av(321))$, l'unico candidato \'e $321$, quindi la preimmaigine \'e il pattern $4321$.\\\\
I candidati come preimmagini di $132$ sono i pattern $132,312,321$.\\\\
Per avere i tre elementi che formano il pattern $132$ nell'immagine nello stesso ordine anche nella preimmaigne deve essere presente un elemento maggiore prima di tutti, ottenendo il pattern $4132$: se $4$ bypassa allora anche tutti gli elementi usccessivi bypassano mantenendo lo stesso ordine, se entra in coda tutti gli altri fanno eventualmente uscire alcuni oggetti dalla coda e poi vengono aggiunti all'output nello stesso ordine.\\\\
Per avere un pattern $132$ da un $312$ tramite \textit{queuesort} \'e necessario che $3$ entri in coda, $1$ bypassi, e che la coda venga svuotata. Per assicurarsi che $3$ entri in coda \'e sufficiente imporre che sia un left-to-right-maxima. Per forzare un bypass su $1$ si rende necessario che esso sia minore di tutti gli elementi presenti in pila: questo fatto viene rappresentato da un valore $1^+>1$ (left-to-right-maxima) che verr\'a considerato come il valore massimo quando si arriva ad 1. Infine per forzare l'estrazione di $3$ serve un valore $4$ tra 1 e 2. Da queste condizioni si ottiene il seguente pattern:
\begin{center}
\mmpattern{scale=1.6}{3}{1/3,2/1,3/2}{0/3}{0/0/1/1/1,2/3/3/4/1}$\Rightarrow$
\mmpattern{scale=1.4}{4}{1/1,2/4,3/2,4/3}{0/1,0/2,0/3,0/4,1/4}{3/4/4/5/1}$\Rightarrow$
\mmpattern{scale=1.2}{5}{1/1,2/4,3/1,4/5,5/3}{0/1,0/2,0/3,0/4,0/5,1/4,1/5}{}
\end{center}
$$(Q_{POP}\circ{Q})^{-1}(Av(21))=Av(4132,4321,\mmpattern{scale=0.8}{5}{1/1,2/4,3/1,4/5,5/3}{0/1,0/2,0/3,0/4,0/5,1/4,1/5}{})$$
\section*{Idee per la ricerca di preimmagini secondo l'operatore POPstacksort}
Si ricercano i candidati come si fa per gli operatori regoalari.\\
Per ogni candidato si esaminano tutte le coppie non ordinate:
\begin{description}
\item se una coppia non ordinata $(b,a)$ \'e presente sia nel candidato che nell'immagine allora l'elemento $b$ viene inserito nella pila ed estratto prima che vi venga inserito $a$, quindi \'e presente un elemento maggiore di $b$ tra i due che provoca il POP
\begin{center}
\mpattern{scale=1.5}{2}{1/2,2/1}{} $\Rightarrow$ \mmpattern{scale=1.5}{2}{1/2,2/1}{}{1/2/2/3/1}
\end{center} \item se una coppia non ordinata $(b,a)$ \'e presente nel candidato ma non nell'immagine allora l'elemento $b$ viene inserito nella pila e non si verifica nessun POP prima che $a$ vi venga inserito sopra
\begin{center}
\mpattern{scale=1.5}{2}{1/2,2/1}{} $\Rightarrow$ \mmpattern{scale=1.5}{2}{1/2,2/1}{1/2}{}
\end{center} 
\end{description}
\section*{Idee per la ricerca di preimmagini secondo l'operatore POPqueuesort}
Si ricercano i candidati come si fa per gli operatori regoalari.\\
Per ogni candidato si esaminano tutte le coppie non ordinate:
\begin{description}
\item se una coppia non ordinata $(b,a)$ \'e presente sia nel candidato che nell'immagine allora l'elemento $b$ effettua un bypass della coda, e quindi non \'e un left-to-right-maxima, oppure entra nella coda (quindi \'e un left-to-right-maxima) e viene estratto prima $a$ possa bypassare, quindi l'area superiore a $b$ contenuta tra $b$ e $a$ deve contenere almeno due elemnti non ordinati.
\begin{center}
\mpattern{scale=1.5}{2}{1/2,2/1}{} $\Rightarrow$
\mmpattern{scale=1.5}{2}{1/2,2/1}{1/2}{0/2/1/3/1},
\mmpattern{scale=1.2}{4}{1/2,2/4,3/3,4/1}{0/2,0/3,0/4}{}
\end{center} 
\item se una coppia non ordinata $(b,a)$ \'e presente nel candidato ma non nell'immagine allora l'elemento $b$ viene inserito nella pila e non si verifica nessun POP prima che $a$ possa bypassare, quindi $b$ \'e un left-to-right-maxima e tra $b$ e $a$ tutti gli elementi bypassano o vengono accodati, quest'ultima condizione in particolare si verifica se tutte le coppie $c,d: b<c<d$ in posizione tra $b$ e $a$ sono ordinate
\begin{center}
\mpattern{scale=1.5}{2}{1/2,2/1}{} $\Rightarrow$
\mmpattern{scale=1.5}{3}{1/2,2/3,3/1}{0/2,2/2}{}
\end{center} 
\end{description}
\subsection*{$S\circ{S_{POP}}$}
$$(S\circ{S_{POP}})^{-1}(Av(21))=S_{POP}^{-1}S^{-1}(Av(21))=S_{POP}^{-1}(Av(231))$$
$231$ ha come preimmagini $231,321$.\\
Per trovare le preimmagini del pattern $231$ si parte dal candidato $231$, che deve essere lasciato invariato. Deve succedere che $2$ entra in pila, la sua estrazione pu\'o essere causata da $3$, che poi viene aggiunto in coda ed infine deve essere estratto prima che $1$ vi entri.